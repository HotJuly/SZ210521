# 小程序用户授权

1. 截至到2021年10月19日,一共出现过三种用户授权方案
2. 首次登录授权:
   1. 早期
      1. API:wx.getUserInfo()
      2. 在小程序早期,该API可以直接弹出授权窗口,早期该API被滥用,导致用户还没看到项目的内容,就被迫获取用户信息,最终该方案被废弃
   2. 中期(使用时间最长的版本,到21年4月份才开始废弃)
      1. 需要使用到的组件:button
      2. 流程:
         1. 给button组件添加标签属性open-type="getUserInfo"
         2. 给button组件绑定事件,事件名称:getuserinfo
         3. 可以通过回调函数的形参,获取到用户的个人信息res.detail.userInfo
         4. 将该数据更新到data中
         5. 在模版中将该数据进行动态展示
   3. 最新
      1. API:wx.getUserProfile()
      2. 特点:
         1. **该API每次调用都会弹出授权窗口**
         2. **desc属性必须要传**
      3. 问题:
         1. 错误:wx.getUserProfile is not a function
            1. 解决方案:该问题是因为当前小程序基础库版本太低导致的,至少在2.15.0以上才能使用
         2. 错误:虽然wx.getUserProfile已经调用成功,但是并没有获取到用户信息
            1. **该方法,必须在点击事件的回调函数中调用才能生效**
         3. 错误:无法实现二次登陆免授权功能
            1. 可以当用户授权成功之后,将授权得到的数据缓存起来,留作下次使用
3. 二次登陆免授权(**静默登录**)
   1. 需求:当用户进入该项目的时候,自动获取到用户的授权信息,并展示在页面上
   2. 拆解:
      1. 当用户进入该项目的时候
         1. 绑定事件监听(生命周期函数)
      2. 自动获取到用户的授权信息
         1. 使用js获取到用户授权信息
         2. API:wx.getUserInfo(Object object)
      3. 展示在页面上
         1. 将该数据更新到data中
   3. 注意:wx.getUserInfo方法必须在用户经过了首次登录授权流程之后,才能使用,否则无效
4. 神奇的组件
   1. 该组件可以展示用户的基本信息
   2. 但是该组件很鸡肋,只能看,不能用(用户可以看到数据,但是小程序开发者无法获取到该数据)
